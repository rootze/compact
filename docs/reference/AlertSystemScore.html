<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>AlertSystem: score pathway gene sets for a given module perturbation — AlertSystemScore • compact</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="AlertSystem: score pathway gene sets for a given module perturbation — AlertSystemScore"><meta name="description" content='This function implements the AlertSystem pathway scoring workflow for a
single module perturbation. It:
Filters the input gene sets to features present in the Seurat object.
Computes UCell scores for each gene set on the baseline assay
(e.g. "RNA") and on the perturbation assay
(e.g. "M6_up").
Computes per-pathway log2 fold-changes,
\( \log_2 \left( \frac{\mathrm{post} + \varepsilon}{\mathrm{pre} + \varepsilon} \right) \).
Aggregates logFC per group (if group.by is provided) or
across all cells, and computes group-wise metrics including:
effect: mean/median logFC,
concordance: fraction of cells whose logFC sign matches
the group-level effect sign.
robustness (optional): fraction of cells whose
logFC is both (i) above the magnitude threshold
(|logFC| ≥ robust_effect_thresh) and
(ii) has the same sign as the group-level effect.

Extracts all UCell (pre/post) and logFC columns created during
scoring and stores them, along with the metrics table and
run parameters, in seurat_obj@misc$AlertSystem.
Optionally saves all AlertSystem results as a single RDS file
(containing seurat_obj@misc$AlertSystem) and exports the
pathway-level metrics table as a CSV file in out_dir.
Restores the original seurat_obj@meta.data, so that the
object is not permanently bloated by intermediate score columns.

'><meta property="og:description" content='This function implements the AlertSystem pathway scoring workflow for a
single module perturbation. It:
Filters the input gene sets to features present in the Seurat object.
Computes UCell scores for each gene set on the baseline assay
(e.g. "RNA") and on the perturbation assay
(e.g. "M6_up").
Computes per-pathway log2 fold-changes,
\( \log_2 \left( \frac{\mathrm{post} + \varepsilon}{\mathrm{pre} + \varepsilon} \right) \).
Aggregates logFC per group (if group.by is provided) or
across all cells, and computes group-wise metrics including:
effect: mean/median logFC,
concordance: fraction of cells whose logFC sign matches
the group-level effect sign.
robustness (optional): fraction of cells whose
logFC is both (i) above the magnitude threshold
(|logFC| ≥ robust_effect_thresh) and
(ii) has the same sign as the group-level effect.

Extracts all UCell (pre/post) and logFC columns created during
scoring and stores them, along with the metrics table and
run parameters, in seurat_obj@misc$AlertSystem.
Optionally saves all AlertSystem results as a single RDS file
(containing seurat_obj@misc$AlertSystem) and exports the
pathway-level metrics table as a CSV file in out_dir.
Restores the original seurat_obj@meta.data, so that the
object is not permanently bloated by intermediate score columns.

'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">compact</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/basic_tutorial.html">co-expression module perturbation analysis</a></li>
    <li><a class="dropdown-item" href="../articles/TF_tutorial.html">transcription factor perturbation analysis</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>AlertSystem: score pathway gene sets for a given module perturbation</h1>

      <div class="d-none name"><code>AlertSystemScore.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function implements the AlertSystem pathway scoring workflow for a
single module perturbation. It:</p><ol><li><p>Filters the input gene sets to features present in the Seurat object.</p></li>
<li><p>Computes UCell scores for each gene set on the baseline assay
(e.g. <code>"RNA"</code>) and on the perturbation assay
(e.g. <code>"M6_up"</code>).</p></li>
<li><p>Computes per-pathway log2 fold-changes,
\( \log_2 \left( \frac{\mathrm{post} + \varepsilon}{\mathrm{pre} + \varepsilon} \right) \).</p></li>
<li><p>Aggregates logFC per group (if <code>group.by</code> is provided) or
across all cells, and computes group-wise metrics including:</p><ul><li><p><em>effect</em>: mean/median logFC,</p></li>
<li><p><em>concordance</em>: fraction of cells whose logFC sign matches
the group-level effect sign.</p></li>
<li><p><em>robustness</em> (optional): fraction of cells whose
logFC is both (i) above the magnitude threshold
(|logFC| ≥ <code>robust_effect_thresh</code>) and
(ii) has the same sign as the group-level effect.</p></li>
</ul></li>
<li><p>Extracts all UCell (pre/post) and logFC columns created during
scoring and stores them, along with the metrics table and
run parameters, in <code>seurat_obj@misc$AlertSystem</code>.</p></li>
<li><p>Optionally saves all AlertSystem results as a single RDS file
(containing <code>seurat_obj@misc$AlertSystem</code>) and exports the
pathway-level metrics table as a CSV file in <code>out_dir</code>.</p></li>
<li><p>Restores the original <code>seurat_obj@meta.data</code>, so that the
object is not permanently bloated by intermediate score columns.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">AlertSystemScore</span><span class="op">(</span></span>
<span>  <span class="va">seurat_obj</span>,</span>
<span>  <span class="va">gene_sets</span>,</span>
<span>  <span class="va">perturbation_name</span>,</span>
<span>  <span class="va">base_tag</span>,</span>
<span>  baseline_assay <span class="op">=</span> <span class="st">"RNA"</span>,</span>
<span>  group.by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  out_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_genes <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  eps <span class="op">=</span> <span class="fl">1e-10</span>,</span>
<span>  summary_fun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span><span class="op">)</span>,</span>
<span>  return_details <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  compute_concordance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  compute_robustness <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  robust_effect_thresh <span class="op">=</span> <span class="fl">0.01</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-seurat-obj">seurat_obj<a class="anchor" aria-label="anchor" href="#arg-seurat-obj"></a></dt>
<dd><p>A Seurat object that already contains the perturbation
assay generated by <code>ModulePerturbation</code> (e.g. an assay named
<code>"M6_up"</code>).</p></dd>


<dt id="arg-gene-sets">gene_sets<a class="anchor" aria-label="anchor" href="#arg-gene-sets"></a></dt>
<dd><p>Named list of character vectors, each defining a pathway
gene set to score.</p></dd>


<dt id="arg-perturbation-name">perturbation_name<a class="anchor" aria-label="anchor" href="#arg-perturbation-name"></a></dt>
<dd><p>Name of the perturbation assay in <code>seurat_obj</code>
(e.g. <code>"M6_up"</code>).</p></dd>


<dt id="arg-base-tag">base_tag<a class="anchor" aria-label="anchor" href="#arg-base-tag"></a></dt>
<dd><p>Character string used to construct suffixes for baseline,
perturbation and logFC columns. For example, if <code>base_tag = "M6"</code>
and <code>baseline_assay = "RNA"</code>, generated columns will end in
<code>"_M6_RNA"</code>, <code>"_M6_M6up"</code>, and <code>"_M6_logFC"</code>.</p></dd>


<dt id="arg-baseline-assay">baseline_assay<a class="anchor" aria-label="anchor" href="#arg-baseline-assay"></a></dt>
<dd><p>Name of the baseline assay to use for pre-perturbation
UCell scoring (default <code>"RNA"</code>).</p></dd>


<dt id="arg-group-by">group.by<a class="anchor" aria-label="anchor" href="#arg-group-by"></a></dt>
<dd><p>Optional metadata column name used to group cells for
summarization. If <code>NULL</code>, all cells are treated as a single group
named <code>"all_cells"</code>.</p></dd>


<dt id="arg-out-dir">out_dir<a class="anchor" aria-label="anchor" href="#arg-out-dir"></a></dt>
<dd><p>Optional directory where AlertSystem outputs will be saved.
If provided, the function writes a single RDS file containing the full
<code>seurat_obj@misc$AlertSystem</code> list (AlertSystem_info) and a CSV
file with the pathway-level metrics table. If <code>NULL</code>, results are
not written to disk.</p></dd>


<dt id="arg-min-genes">min_genes<a class="anchor" aria-label="anchor" href="#arg-min-genes"></a></dt>
<dd><p>Minimum number of genes required to retain a gene set
after intersecting with the Seurat object's feature set.</p></dd>


<dt id="arg-eps">eps<a class="anchor" aria-label="anchor" href="#arg-eps"></a></dt>
<dd><p>Small numeric constant, epsilon, added to pre and post scores in the
logFC computation to avoid division by zero.</p></dd>


<dt id="arg-summary-fun">summary_fun<a class="anchor" aria-label="anchor" href="#arg-summary-fun"></a></dt>
<dd><p>Aggregation function used for group-wise effect
computation in the metrics table, one of <code>"mean"</code> or <code>"median"</code>.</p></dd>


<dt id="arg-return-details">return_details<a class="anchor" aria-label="anchor" href="#arg-return-details"></a></dt>
<dd><p>Logical; if <code>FALSE</code> (default), the function
returns only the updated Seurat object with results stored under
<code>seurat_obj@misc$AlertSystem</code>. If <code>TRUE</code>, a list is returned
containing the Seurat object, per-cell scores, metrics table, and any
file paths used for saving.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical; if <code>TRUE</code> (default), progress messages are printed
during scoring and summarization. Set to <code>FALSE</code> to suppress console output.</p></dd>


<dt id="arg-compute-concordance">compute_concordance<a class="anchor" aria-label="anchor" href="#arg-compute-concordance"></a></dt>
<dd><p>Logical; if <code>TRUE</code> (default), compute a
concordance score per group × pathway as the fraction of cells whose logFC
sign matches the group-level effect sign.</p></dd>


<dt id="arg-compute-robustness">compute_robustness<a class="anchor" aria-label="anchor" href="#arg-compute-robustness"></a></dt>
<dd><p>Logical; if <code>TRUE</code> (default), a robustness metric is computed
per group × pathway as the fraction of all cells whose logFC is both
(i) above the magnitude threshold (|logFC| ≥ <code>robust_effect_thresh</code>)
and (ii) has the same sign as the group-level effect.</p></dd>


<dt id="arg-robust-effect-thresh">robust_effect_thresh<a class="anchor" aria-label="anchor" href="#arg-robust-effect-thresh"></a></dt>
<dd><p>Numeric threshold on per-cell logFC used to define
"strong responders" in the robustness metric <code>robust_gt_thresh</code>.
For each group × pathway, <code>robust_gt_thresh</code> is the fraction of all
cells whose logFC is both (i) above this magnitude threshold
(|logFC| ≥ <code>robust_effect_thresh</code>) and (ii) has the same sign as the
group-level effect. If <code>robust_effect_thresh = 0</code>, this metric is
not computed and <code>robust_gt_thresh</code> is set to <code>NA</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>return_details = FALSE</code> (default), returns the Seurat
object with <code>seurat_obj@misc$AlertSystem</code> populated and the
original metadata restored. If <code>return_details = TRUE</code>, returns a
list with elements:</p><dl><dt>seurat</dt>
<dd><p>The updated Seurat object.</p></dd>

<dt>per_cell</dt>
<dd><p>Data frame of per-cell UCell and logFC scores
(also stored in <code>seurat_obj@misc$AlertSystem$per_cell</code>).</p></dd>

<dt>metrics</dt>
<dd><p>Long-format data frame of group-wise metrics
(effect, concordance, robustness) for each pathway
(also stored in <code>seurat_obj@misc$AlertSystem$metrics</code>).</p></dd>

<dt>info_file</dt>
<dd><p>Path to the RDS file storing the full
<code>seurat_obj@misc$AlertSystem</code> list (or <code>NULL</code> if
<code>out_dir</code> was not provided).</p></dd>

<dt>metrics_file</dt>
<dd><p>Path to the CSV file containing the metrics table
(or <code>NULL</code> if <code>out_dir</code> was not provided).</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Load pathway gene sets (local directory or GitHub fallback)</span></span></span>
<span class="r-in"><span><span class="va">alertdatabasePATH</span> <span class="op">&lt;-</span> <span class="st">"/dataPATH/"</span></span></span>
<span class="r-in"><span><span class="va">genetype</span> <span class="op">&lt;-</span> <span class="st">"mouse"</span>  <span class="co"># or "human"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gene_sets_mouse</span> <span class="op">&lt;-</span> <span class="fu"><a href="LoadAlertSystemPathways.html">LoadAlertSystemPathways</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  path <span class="op">=</span> <span class="va">alertdatabasePATH</span>,</span></span>
<span class="r-in"><span>  genetype<span class="op">=</span> <span class="st">"mouse"</span>,</span></span>
<span class="r-in"><span>  database <span class="op">=</span> <span class="st">"MSigDBhallmark"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic usage: concordance on, robustness on (default)</span></span></span>
<span class="r-in"><span><span class="va">seurat_obj</span> <span class="op">&lt;-</span> <span class="fu">AlertSystemScore</span><span class="op">(</span></span></span>
<span class="r-in"><span>  seurat_obj         <span class="op">=</span> <span class="va">seurat_obj</span>,</span></span>
<span class="r-in"><span>  gene_sets          <span class="op">=</span> <span class="va">gene_sets_mouse</span>,</span></span>
<span class="r-in"><span>  perturbation_name  <span class="op">=</span> <span class="st">"M6_up"</span>,</span></span>
<span class="r-in"><span>  base_tag           <span class="op">=</span> <span class="st">"M6"</span>,</span></span>
<span class="r-in"><span>  baseline_assay     <span class="op">=</span> <span class="st">"RNA"</span>,</span></span>
<span class="r-in"><span>  group.by           <span class="op">=</span> <span class="st">"cell_types_broad"</span>,</span></span>
<span class="r-in"><span>  out_dir            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,   <span class="co"># save AlertSystem_info RDS + metrics CSV</span></span></span>
<span class="r-in"><span>  verbose            <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access metrics (effect + concordance + robustness)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">seurat_obj</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">AlertSystem</span><span class="op">$</span><span class="va">metrics</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example with a stricter robustness threshold</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">AlertSystemScore</span><span class="op">(</span></span></span>
<span class="r-in"><span>  seurat_obj          <span class="op">=</span> <span class="va">seurat_obj</span>,</span></span>
<span class="r-in"><span>  gene_sets           <span class="op">=</span> <span class="va">gene_sets_mouse</span>,</span></span>
<span class="r-in"><span>  perturbation_name   <span class="op">=</span> <span class="st">"M6_up"</span>,</span></span>
<span class="r-in"><span>  base_tag            <span class="op">=</span> <span class="st">"M6"</span>,</span></span>
<span class="r-in"><span>  baseline_assay      <span class="op">=</span> <span class="st">"RNA"</span>,</span></span>
<span class="r-in"><span>  group.by            <span class="op">=</span> <span class="st">"cell_types_broad"</span>,</span></span>
<span class="r-in"><span>  compute_robustness <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  robust_effect_thresh  <span class="op">=</span> <span class="fl">0.1</span>,   <span class="co"># only count cells with |logFC| ≥ 0.1</span></span></span>
<span class="r-in"><span>  return_details      <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  verbose             <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">metrics</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://smorabit.github.io" class="external-link">Sam Morabito</a>, <a href="https://github.com/rootze" class="external-link">Zechuan Shi</a>, <a href="https://swaruplab.bio.uci.edu/" class="external-link">Swarup Lab</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

