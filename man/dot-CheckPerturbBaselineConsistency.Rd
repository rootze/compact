% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CombinePerturbAssays.R
\name{.CheckPerturbBaselineConsistency}
\alias{.CheckPerturbBaselineConsistency}
\title{.CheckPerturbBaselineConsistency: heuristic sanity-check against a baseline}
\usage{
.CheckPerturbBaselineConsistency(
  base_mat,
  pert_mat,
  assay_name = "pert",
  eps = 0.001,
  max_frac_changed = 0.35,
  max_abs_median = 0.05,
  max_abs_mean = 0.05,
  strict = FALSE,
  n_genes = 2000,
  n_cells = 500,
  seed = NULL
)
}
\arguments{
\item{base_mat}{Baseline expression matrix (genes x cells).}

\item{pert_mat}{Perturbation expression matrix (genes x cells).}

\item{assay_name}{Character label used in messages.}

\item{eps}{Numeric; values with \code{|Δ| <= eps} are treated as unchanged.}

\item{max_frac_changed}{Numeric in (0,1); warn/stop if too many entries differ.}

\item{max_abs_median}{Numeric; warn/stop if \code{median(|Δ|)} is too large.}

\item{max_abs_mean}{Numeric; warn/stop if \code{|mean(Δ)|} is too large.}

\item{strict}{Logical; if \code{TRUE}, stop on suspicious results; otherwise warn.}

\item{n_genes}{Integer; number of genes to sample for the check (default 2000).}

\item{n_cells}{Integer; number of cells to sample for the check (default 500).}

\item{seed}{Optional integer; set for reproducible sampling.}
}
\value{
Invisibly returns a list of summary statistics and a suspicious flag.
}
\description{
This function performs a heuristic check that a perturbation expression
matrix is numerically consistent with a specified baseline matrix. It is
intended for cases where explicit provenance is missing (i.e. no call to
\code{StampPerturbProvenance()}) and the user wants a guardrail against
combining assays generated from mismatched baselines/normalizations/slots.
}
\details{
The check computes \eqn{\Delta = P - B} on overlapping genes and summarizes:
\itemize{
\item fraction of entries with \code{|Δ| > eps}
  \item \code{median(|Δ|)}
  \item \code{|mean(Δ)|} (detects global shifts)
}
If any summary exceeds user-defined thresholds, the function warns or stops.

Note: This is not a proof of shared provenance; it is a numeric sanity check.
}
\keyword{internal}
